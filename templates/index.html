{% extends "base.html" %}

{% block title %}书山有路勤为径，学海无涯苦作舟{% endblock %}

{% block content %}
<div id="posts-container" class="row">
    {% for post in posts.posts %}
    <div class="col-md-6 col-lg-4 post-item">
        <div class="card post-card h-100 clickable-card" onclick="window.location.href='/post/{{ post.id }}'">
            <div class="card-body p-4">
                <h5 class="card-title">
                    <a href="/post/{{ post.id }}" class="text-decoration-none stretched-link">{{ post.title }}</a>
                </h5>
                <div class="post-summary text-muted mb-3">
                    {{ post.summary or '暂无摘要' }}
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- 加载提示 -->
<div id="loading" class="text-center mt-4" style="display: none;">
    <div class="spinner-border" role="status">
        <span class="visually-hidden">加载中...</span>
    </div>
    <p class="mt-3 text-muted" style="font-style: italic;">正在加载更多文章...</p>
</div>

<!-- 无更多内容提示 -->
<div id="no-more" class="text-center mt-4" style="display: none;">
    <p class="text-muted" style="font-style: italic;">"山重水复疑无路，柳暗花明又一村" - 已加载全部文章</p>
</div>

<!-- 在现有的JavaScript部分添加以下修改 -->
<script>
// 修改无限滚动加载函数
async function loadMorePosts() {
    if (loading || !hasMore) return;
    
    loading = true;
    showLoading();
    
    try {
        // 修改为静态文件路径
        const response = await fetch(`./api/posts/page_${page}.json`);
        
        if (!response.ok) {
            hasMore = false;
            hideLoading();
            return;
        }
        
        const result = await response.json();
        
        if (result.success && result.data.posts.length > 0) {
            result.data.posts.forEach(post => {
                const postElement = createPostElement(post);
                postsContainer.appendChild(postElement);
            });
            
            page++;
            hasMore = result.data.has_next;
        } else {
            hasMore = false;
        }
    } catch (error) {
        console.error('加载文章失败:', error);
        hasMore = false;
    } finally {
        loading = false;
        hideLoading();
    }
}

// 修改文章元素创建函数中的链接
function createPostElement(post) {
    const postDiv = document.createElement('div');
    postDiv.className = 'col-md-6 col-lg-4 mb-4';
    
    postDiv.innerHTML = `
        <div class="card post-card h-100">
            <div class="card-body d-flex flex-column">
                <h5 class="card-title">
                    <a href="./post/${post.id}.html" class="text-decoration-none">${post.title}</a>
                </h5>
                <p class="card-text flex-grow-1">${post.summary || post.content.substring(0, 150) + '...'}</p>
            </div>
        </div>
    `;
    
    return postDiv;
}
</script>
{% endblock %}

<style>
.post-item {
    margin-bottom: 20px;
}

.post-card {
    transition: all 0.3s ease;
    position: relative;
}

.clickable-card {
    cursor: pointer;
}

.clickable-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.2);
}

.clickable-card:active {
    transform: translateY(-4px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

.stretched-link {
    color: inherit;
}

.stretched-link:hover {
    color: #0d6efd;
    text-decoration: none;
}

#loading {
    padding: 20px;
}

#no-more {
    padding: 20px;
    border-top: 1px solid #eee;
}

/* 响应式调整 */
@media (max-width: 768px) {
    .post-item {
        margin-bottom: 15px;
    }
    
    .clickable-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
}
</style>